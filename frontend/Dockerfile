
# å»ºç«‹éšæ®µï¼šå®‰è£èˆ‡æ‰“åŒ…å‰ç«¯
# ğŸ“Œ `/app` æ˜¯å®¹å™¨å…§çš„å·¥ä½œè³‡æ–™å¤¾ï¼Œèˆ‡ä½ æœ¬æ©Ÿè³‡æ–™å¤¾åç¨±ç„¡é—œã€‚
# ğŸ“Œ `/app/dist` æ˜¯ Vite é è¨­è¼¸å‡ºçš„æ‰“åŒ…è³‡æ–™å¤¾ï¼Œä¸éœ€ä¿®æ”¹é™¤éä½ åœ¨ `vite.config.js` è£¡æ”¹äº† `outDir`ã€‚

# å»ºç«‹éšæ®µï¼šå®‰è£èˆ‡æ‰“åŒ…å‰ç«¯
FROM node:18 AS builder
WORKDIR /app

# âœ… å®£å‘Šè¦æ¥æ”¶å¤–éƒ¨æ³¨å…¥çš„ç’°å¢ƒè®Šæ•¸
ARG VITE_API_BASE_URL
ENV VITE_API_BASE_URL=$VITE_API_BASE_URL

# âœ… è‡ªè¡Œç”Ÿæˆ .env.production æª”æ¡ˆä¾› Vite ä½¿ç”¨ï¼ˆæ³¨æ„é€™æ˜¯é—œéµï¼‰
RUN echo "VITE_API_BASE_URL=$VITE_API_BASE_URL" > .env.production

# âœ… è¤‡è£½æ•´å€‹å‰ç«¯å°ˆæ¡ˆï¼ˆå« package.jsonã€srcã€vite.config.js ç­‰ï¼‰
COPY . .  

# âœ… å®‰è£ä¾è³´ï¼ˆæœƒè®€å– package.jsonï¼‰
RUN npm install

# âœ… æ‰“åŒ…ç”¢å‡º dist/
RUN npm run build

# éƒ¨ç½²éšæ®µï¼šä½¿ç”¨ Nginx serveæä¾›éœæ…‹æª”æ¡ˆ

# ğŸš€ éƒ¨ç½²éšæ®µï¼šä½¿ç”¨ nginx æä¾›éœæ…‹è³‡æºæœå‹™
FROM nginx:alpine

# âœ… å°‡å‰›å‰›æ‰“åŒ…å¥½çš„ dist è¤‡è£½é€² nginx é è¨­è·¯å¾‘
COPY --from=builder /app/dist /usr/share/nginx/html

# âœ… é–‹æ”¾ 80 portï¼ˆéœæ…‹ç¶²ç«™ä½¿ç”¨ï¼‰
EXPOSE 80

# âœ… å•Ÿå‹• nginxï¼ˆ-g daemon off: å‰æ™¯æ¨¡å¼ï¼‰
CMD ["nginx", "-g", "daemon off;"]


