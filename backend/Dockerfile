# ğŸš€ å»ºç«‹ç’°å¢ƒ
FROM node:18
WORKDIR /app

# âœ… å¿«å–å„ªåŒ–ï¼šå…ˆæ‹·è² package.json å’Œ lock æª”ä»¥åˆ© npm install å¿«å–å±¤
COPY package*.json ./

# âœ…  âœ… å®‰è£ä¾è³´ï¼ˆä¸å»ºè­°å¸¶å…¥æœ¬åœ° node_modulesï¼‰ å®‰è£æ™‚ä¸è¦ç”¨ Mac çš„ bcryptï¼Œè¦åœ¨ Linux ç’°å¢ƒè£¡é‡å»º
RUN npm install

# âœ… å†æ‹·è²å‰©ä¸‹ç¨‹å¼ç¢¼ï¼ˆé¿å…å› ç¨‹å¼ç¢¼æ›´å‹•è€Œè§¸ç™¼ npm install é‡è·‘ï¼‰
COPY . .

# âœ… ä¿®å¾© Mac å®‰è£ bcrypt binary çš„å•é¡Œï¼ˆéå¿…è¦ä½†å»ºè­°åŠ ï¼‰
# âœ… å¦‚æœä½ å·²ç¶“ä¸å°å¿ƒ COPY é€²ä¾† Mac çš„ bcrypt binary
# å¯ä»¥åŠ é€™è¡Œå¼·åˆ¶é‡å»º native binaryï¼š
RUN npm rebuild bcrypt --build-from-source

EXPOSE 3000
CMD ["node", "app.js"]
